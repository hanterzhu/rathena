new_3-1,52,103,5	script	test1	100,{
    //makepet 1002,0,1000,100,1,"小可爱",1,2,3,4,5,6,1,1,0,2,2,0,1,1,0,2,2,0,1,1,0,100;
    //end;

    if (getpetextrainfo()) {
        dispbottom "name: " + @pet_name_info$;
        for (.@i = 0; .@i < getarraysize(@pet_base_info); .@i++) {
            dispbottom "" + @pet_base_info[.@i];
        }

        .@j = 1;
        for (.@i = 7; .@i < getarraysize(@pet_extra_info); .@i+=3) {
            if (@pet_extra_info[.@i]) {
                .@desc$ =  $@pet_option_description$[@pet_extra_info[.@i]];
                .@value = @pet_extra_info[.@i+1];
                .@format$ = "第 [%d] 条：" + callfunc("align_text", "属性: ", .@desc$, 20, "数值: ", .@value);
                dispbottom sprintf(.@format$, .@j);
                .@j++;
            }
        }
    }

    //callfunc("del_zeny", 200);
    //callfunc("del_item", 501, 1, 502, 1);
    //dispbottom "当前战力[" + readparam(bCombatPower) + "]";
    //deletearray $@mobid,getarraysize($@mobid);
    //monster "new_3-1",52,105,"--ja--",1080,1;
    //@mobid = $@mobid[0];
    end;
}

//new_3-1,52,104	monster	波利	1002,1

new_3-1,54,103,5	script	test3	100,{
    .@name$ = getunitname(@mobid);
    .@count = damage_log_rank(@mobid, .@id, .@damage, 0, 1, 1);
    dispbottom "记录数: " + .@count;
    for (.@i = 0; .@i < .@count; .@i++) {
        dispbottom "第 " + (.@i + 1) + ": " + .@id[.@i] + " 伤害: " + .@damage[.@i];
    }
    //dispbottom strcharinfo(0, getcharid(0)) + " 受到 " + .@name$ + "伤害：" + damage_log_query(getcharid(0), @mobid, 0, 1);
    //dispbottom .@name$ + " 受到 " + strcharinfo(0, getcharid(0)) + "伤害：" + damage_log_query(@mobid, getcharid(0), 0, 1);
    //log_damage_reset(@mobid);
    end;
}

new_3-1,55,108,5	script	chaika	100,{
    input .@name$;
    dispbottom "" + login(.@name$);
    end;
    //achievementcomplete 110013;
    //callfunc "拆卡";
}

new_3-1	mapflag	norodex

new_3-1,52,115,5	script	test	100,{
    mes "请在一分钟内做出选择:";
    mes "选项 A";
    mes "选项 B";
    attachnpctimer;
    initnpctimer;
    next;
    switch(select("选项 A:选项 B")) {
    case 1:
        mes "你选择了选项 A.";
        stopnpctimer;
        close;
    case 2:
        mes "你选择了选项 B.";
        stopnpctimer;
        close;
    }

OnTimer5000:
   stopnpctimer;
   mes "你没有在一分钟内做出选择.";
   atcommand "@kick " + strcharinfo(0);
   end;
}

-	script	test2	-1,{
OnPCEquipEvent:
    set .@id, getinventoryinfo(@equip_idx,0);
    set .@index, getiteminfo(.@id,ITEMINFO_LOCATIONS);
    if (.@index & EQP_COSTUME_HEAD_TOP) {
        set costume_top_view, getiteminfo(.@id,ITEMINFO_VIEW);
    }
    if (.@index & EQP_COSTUME_HEAD_MID) {
        set costume_middle_view, getiteminfo(.@id,ITEMINFO_VIEW);
    }
    if (.@index & EQP_COSTUME_HEAD_LOW) {
        set costume_bottom_view, getiteminfo(.@id,ITEMINFO_VIEW);
    }
    dispbottom "equip id: " + .@id;
    dispbottom "增加战力 [" + getitemcombatpower(@equip_idx) + "]，当前战力[" + readparam(bCombatPower) + "]";
    end;

OnPCUnequipEvent:
    set .@id, getinventoryinfo(@unequip_idx,0);
    set .@index, getiteminfo(.@id,ITEMINFO_LOCATIONS);
    if (.@index & EQP_COSTUME_HEAD_TOP) {
        set costume_top_view, 0;
    }
    if (.@index & EQP_COSTUME_HEAD_MID) {
        set costume_middle_view, 0;
    }
    if (.@index & EQP_COSTUME_HEAD_LOW) {
        set costume_bottom_view, 0;
    }
    dispbottom "unequip id: " + .@id;
    dispbottom "减少战力 [" + getitemcombatpower(@equip_idx) + "]，当前战力[" + readparam(bCombatPower) + "]";
    end;

OnPCIdentifyEvent:
    dispbottom "@identify_idx: " + @identify_idx;
    dispbottom "@identify_id: " + getinventoryinfo(@identify_idx,0);
    end;

OnPCTitleEvent:
    dispbottom "@title_id_pre: " + @title_id_pre;
    dispbottom "@title_id: " + @title_id;
    end;

OnPCClickNpcFilter:
    dispbottom "@npc_type: " + @npc_type;
    if (@npc_type == 2) {
        if (!checkweight(2607,5)) {
            dispbottom "确保背包剩余空间 > 5 且剩余负重 > 100",0xFFFF63;
            processhalt;
        }
    }
    end;

OnPCLoginEvent:
    if (costume_top_view > 0) {
        changelook LOOK_HEAD_TOP, costume_top_view;
    }
    if (costume_middle_view > 0) {
        changelook LOOK_HEAD_MID, costume_middle_view;
    }
    if (costume_bottom_view > 0) {
        changelook LOOK_HEAD_BOTTOM, costume_bottom_view;
    }
    end;

OnPCCatchEvent:
    dispbottom "生成宠物蛋";
    set @pet_str, 1;
    set @pet_agi, 2;
    set @pet_vit, 3;
    set @pet_int, 4;
    set @pet_dex, 5;
    set @pet_luk, 6;
    set @pet_option_id0, 7;
    set @pet_option_val0, 8;
    set @pet_option_parm0, 9;
    set @pet_growth, 100;
    end;

OnPCTradeEvent:
    .@index = @index;
    .@char_id = @char_id;
    if (getinventoryinfo(.@index,6,.@char_id) == CARD0_PET) {
        .@pet_id = getinventoryinfo(.@index,7,.@char_id);
        dispbottom "pet id: " + .@pet_id;
        getpetextrainfobyid(.@pet_id,getcharid(0));
        sleep2(500);
        for (.@i = 0; .@i < getarraysize(@pet_extra_info); .@i++) {
            dispbottom "" + @pet_extra_info[.@i];
        }
    }
    end;

//OnPCSellListEvent:
//    setarray @sell_list[0],501,502,503;
//    set @size, getarraysize(@sell_list);
//    end;

OnNPCKillEvent:
    dispbottom "" + killedgid;
    getunitdata killedgid, .@mob_data;
    .@zeny = .@mob_data[UMOB_MONEY];
    if (.@zeny > 0) {
        callfunc("add_zeny", .@zeny);
        end;
    }
    .@level = .@mob_data[UMOB_LEVEL];
    .@class = .@mob_data[UMOB_CLASS];
    if (.@level <= 20) {
        .@zeny = 50;
    } else if (.@level < 40) {
        .@zeny = 100;
    } else if (.@level < 60) {
        .@zeny = 200;
    } else if (.@level < 80) {
        .@zeny = 400;
    } else if (.@level < 90) {
        .@zeny = 800;
    } else {
        .@zeny = 1000;
    }
    if (.@class == CLASS_BOSS) {
        .@zeny *= 100;
    }
    callfunc("add_zeny", .@zeny);
    end;
}
